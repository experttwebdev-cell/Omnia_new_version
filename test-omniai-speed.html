<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test de Vitesse OmnIA</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .container {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      max-width: 800px;
      width: 100%;
      padding: 40px;
    }

    h1 {
      color: #667eea;
      margin-bottom: 10px;
      font-size: 32px;
    }

    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
    }

    .test-section {
      margin-bottom: 30px;
    }

    .test-button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      width: 100%;
      margin-bottom: 15px;
    }

    .test-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
    }

    .test-button:active {
      transform: translateY(0);
    }

    .test-button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .result-box {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 20px;
      margin-top: 15px;
      display: none;
    }

    .result-box.show {
      display: block;
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .timer {
      font-size: 48px;
      font-weight: 700;
      color: #667eea;
      text-align: center;
      margin: 20px 0;
      font-variant-numeric: tabular-nums;
    }

    .timer.running {
      color: #f59e0b;
      animation: pulse 1s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    .metrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .metric {
      background: white;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
    }

    .metric-label {
      font-size: 12px;
      color: #666;
      text-transform: uppercase;
      margin-bottom: 5px;
    }

    .metric-value {
      font-size: 24px;
      font-weight: 700;
      color: #667eea;
    }

    .response-box {
      background: white;
      border-radius: 8px;
      padding: 15px;
      margin-top: 15px;
      border-left: 4px solid #667eea;
      white-space: pre-wrap;
      max-height: 300px;
      overflow-y: auto;
      font-size: 14px;
      line-height: 1.6;
    }

    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
      margin-left: 10px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .speed-rating {
      text-align: center;
      font-size: 24px;
      margin: 20px 0;
    }

    .speed-excellent { color: #10b981; }
    .speed-good { color: #3b82f6; }
    .speed-average { color: #f59e0b; }
    .speed-slow { color: #ef4444; }

    .quick-tests {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px;
      margin-bottom: 20px;
    }

    .quick-test-btn {
      background: white;
      border: 2px solid #667eea;
      color: #667eea;
      padding: 10px 15px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .quick-test-btn:hover {
      background: #667eea;
      color: white;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>‚ö° Test de Vitesse OmnIA</h1>
    <p class="subtitle">Mesurez les performances de votre assistant intelligent</p>

    <div class="test-section">
      <h3 style="margin-bottom: 15px; color: #333;">Tests Rapides</h3>
      <div class="quick-tests">
        <button class="quick-test-btn" onclick="runTest('Je cherche un canap√© scandinave')">
          üõãÔ∏è Canap√© Scandinave
        </button>
        <button class="quick-test-btn" onclick="runTest('Table moderne pour salon')">
          ü™ë Table Moderne
        </button>
        <button class="quick-test-btn" onclick="runTest('Lit en bois pour chambre')">
          üõèÔ∏è Lit en Bois
        </button>
        <button class="quick-test-btn" onclick="runTest('Bonjour, comment allez-vous ?')">
          üí¨ Chat Simple
        </button>
      </div>
    </div>

    <div class="test-section">
      <button id="testBtn" class="test-button" onclick="runCustomTest()">
        üöÄ Test Personnalis√©
      </button>

      <div id="results" class="result-box">
        <div class="timer" id="timer">0.00s</div>
        <div class="speed-rating" id="rating"></div>

        <div class="metrics">
          <div class="metric">
            <div class="metric-label">Temps Total</div>
            <div class="metric-value" id="totalTime">-</div>
          </div>
          <div class="metric">
            <div class="metric-label">Type</div>
            <div class="metric-value" id="intentType">-</div>
          </div>
          <div class="metric">
            <div class="metric-label">Produits</div>
            <div class="metric-value" id="productCount">-</div>
          </div>
        </div>

        <div class="response-box" id="response"></div>
      </div>
    </div>

    <div style="text-align: center; color: #666; font-size: 12px; margin-top: 30px;">
      <p>‚ú® Objectif: &lt; 5s pour recherche produits | &lt; 10s pour chat g√©n√©ral</p>
    </div>
  </div>

  <script type="module">
    import { processOmniaMessage } from './src/lib/omniaChat.ts';

    let startTime;
    let timerInterval;

    window.runTest = async function(message) {
      const testBtn = document.getElementById('testBtn');
      const results = document.getElementById('results');
      const timer = document.getElementById('timer');
      const rating = document.getElementById('rating');
      const totalTime = document.getElementById('totalTime');
      const intentType = document.getElementById('intentType');
      const productCount = document.getElementById('productCount');
      const response = document.getElementById('response');

      // Reset
      results.classList.add('show');
      timer.textContent = '0.00s';
      timer.classList.add('running');
      rating.innerHTML = '‚è≥ Test en cours...';
      rating.className = 'speed-rating';
      totalTime.textContent = '-';
      intentType.textContent = '-';
      productCount.textContent = '-';
      response.textContent = 'Traitement...';

      // Start timer
      startTime = performance.now();
      timerInterval = setInterval(() => {
        const elapsed = (performance.now() - startTime) / 1000;
        timer.textContent = elapsed.toFixed(2) + 's';
      }, 10);

      try {
        // Run test
        const result = await processOmniaMessage(message, [], undefined);
        const endTime = performance.now();
        const duration = (endTime - startTime) / 1000;

        // Stop timer
        clearInterval(timerInterval);
        timer.classList.remove('running');
        timer.textContent = duration.toFixed(2) + 's';

        // Update metrics
        totalTime.textContent = duration.toFixed(2) + 's';
        intentType.textContent = result.intent === 'product_search' ? 'üîç Recherche' : 'üí¨ Chat';
        productCount.textContent = result.products?.length || 0;
        response.textContent = result.content;

        // Speed rating
        let ratingText, ratingClass;
        const isSearch = result.intent === 'product_search';
        const threshold = isSearch ? 3 : 8;

        if (duration < threshold * 0.5) {
          ratingText = 'üöÄ EXCELLENT !';
          ratingClass = 'speed-excellent';
        } else if (duration < threshold) {
          ratingText = '‚úÖ RAPIDE';
          ratingClass = 'speed-good';
        } else if (duration < threshold * 1.5) {
          ratingText = '‚ö†Ô∏è MOYEN';
          ratingClass = 'speed-average';
        } else {
          ratingText = 'üêå LENT';
          ratingClass = 'speed-slow';
        }

        rating.innerHTML = ratingText;
        rating.className = 'speed-rating ' + ratingClass;

      } catch (error) {
        clearInterval(timerInterval);
        timer.classList.remove('running');
        rating.innerHTML = '‚ùå ERREUR';
        rating.className = 'speed-rating speed-slow';
        response.textContent = 'Erreur: ' + error.message;
        console.error('Test error:', error);
      }
    };

    window.runCustomTest = async function() {
      const message = prompt('Entrez votre message de test:', 'Je cherche un canap√© moderne');
      if (message) {
        await window.runTest(message);
      }
    };

    // Auto-run on load
    setTimeout(() => {
      window.runTest('Je cherche un canap√© scandinave pour mon salon');
    }, 500);
  </script>
</body>
</html>
